<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agitator Index // Restricted Access</title>
<style>
  body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; font-family: 'Courier New', monospace; overflow: hidden; color: #fff; }
  
  /* BACKGROUND VIDEO */
  #bg-video {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0.4; z-index: 0; pointer-events: none;
  }

  /* GATEKEEPER CONTAINER */
  #gatekeeper-overlay {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.85);
    display: flex; justify-content: center; align-items: center;
    z-index: 100; transition: opacity 0.8s ease;
    backdrop-filter: blur(5px);
  }

  .gatekeeper-box {
    width: 400px; padding: 40px; 
    border: 1px solid #333; background: #0a0a0a;
    box-shadow: 0 0 50px rgba(0, 255, 65, 0.1);
    text-align: center; position: relative;
  }

  .gatekeeper-status {
    color: #FF3333; font-size: 10px; letter-spacing: 2px; margin-bottom: 20px;
    display: flex; align-items: center; justify-content: center; gap: 8px;
  }
  .blink-dot { width: 8px; height: 8px; background: #FF3333; border-radius: 50%; animation: blink 1s infinite; }
  @keyframes blink { 50% { opacity: 0; } }

  .gatekeeper-logo {
    font-size: 24px; font-weight: bold; color: #fff; letter-spacing: 4px; margin-bottom: 10px;
    text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
  }

  .gatekeeper-text { color: #888; font-size: 12px; line-height: 1.6; margin-bottom: 30px; }

  /* INPUTS */
  .gatekeeper-input-group { position: relative; margin-bottom: 15px; }
  
  input {
    width: 100%; padding: 15px; background: #000; border: 1px solid #333;
    color: #00FF41; font-family: inherit; font-size: 14px; text-align: center;
    box-sizing: border-box; outline: none; transition: all 0.3s;
  }
  input:focus { border-color: #00FF41; box-shadow: 0 0 15px rgba(0, 255, 65, 0.2); }
  input::placeholder { color: #444; }
  input.error { border-color: #FF3333; color: #FF3333; animation: shake 0.3s; }
  @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } 100% { transform: translateX(0); } }

  /* BUTTONS */
  .gatekeeper-btn {
    width: 100%; padding: 15px; border: none; cursor: pointer; font-family: inherit;
    font-weight: bold; font-size: 14px; letter-spacing: 2px; text-transform: uppercase;
    transition: all 0.3s; margin-top: 10px;
  }
  .gatekeeper-btn { background: #00FF41; color: #000; box-shadow: 0 0 20px rgba(0, 255, 65, 0.4); }
  .gatekeeper-btn:hover { background: #fff; box-shadow: 0 0 30px rgba(0, 255, 65, 0.6); }
  
  .gatekeeper-btn.secondary { 
    background: transparent; border: 1px solid #444; color: #666; box-shadow: none; 
  }
  .gatekeeper-btn.secondary:hover { border-color: #fff; color: #fff; }

  .gatekeeper-divider { margin: 20px 0; font-size: 10px; color: #444; letter-spacing: 2px; }
  
  /* SUCCESS MESSAGE */
  #waitlist-status { margin-top: 15px; font-size: 11px; text-transform: uppercase; display: none; }

</style>
</head>
<body>

<div id="bg-video"></div>

<div id="gatekeeper-overlay">
  <div class="gatekeeper-box">
    
    <div class="gatekeeper-status">
      <span class="blink-dot"></span> SYSTEM LOCKED // AUTHORIZATION REQUIRED
    </div>
    
    <div class="gatekeeper-logo">AGITATOR INDEX</div>
    
    <div class="gatekeeper-text">
      This simulation is restricted to Agitator-Grade personnel.
      <br>Enter your clearance code or request priority access.
    </div>

    <div class="gatekeeper-input-group">
      <input type="text" id="access-code" placeholder="ENTER CLEARANCE CODE" onkeyup="checkEnter(event)">
      <button class="gatekeeper-btn" onclick="validateCode()">AUTHENTICATE</button>
    </div>

    <div class="gatekeeper-divider">- OR -</div>

    <form id="waitlist-form" onsubmit="handleWaitlist(event)">
      <div class="gatekeeper-input-group">
        <input type="email" name="email" id="waitlist-email" placeholder="ENTER WORK EMAIL" required>
        <button type="submit" class="gatekeeper-btn secondary">REQUEST ACCESS</button>
      </div>
      <div id="waitlist-status"></div>
    </form>

  </div>
</div>

<script>
  // --- 1. ACCESS CODE LOGIC ---
  const VALID_CODES = ['AGITATOR', 'MONEYBALL', 'VIP2026', 'SAMI'];

  function checkEnter(e) {
    if (e.key === 'Enter') validateCode();
  }

  function validateCode() {
    const input = document.getElementById('access-code');
    const code = input.value.trim().toUpperCase();
    
    if (VALID_CODES.includes(code)) {
      // SUCCESS: Unlock the simulation
      grantAccess();
    } else {
      // FAIL: Visual error
      input.classList.add('error');
      input.value = '';
      input.placeholder = "ACCESS DENIED";
      setTimeout(() => {
        input.classList.remove('error');
        input.placeholder = "ENTER CLEARANCE CODE";
      }, 800);
    }
  }

  function grantAccess() {
    const overlay = document.getElementById('gatekeeper-overlay');
    overlay.style.opacity = '0';
    setTimeout(() => {
      overlay.style.display = 'none';
      // HERE: This is where the main app would reveal itself
      // or redirect to the logged-in area
      // window.location.href = "/simulation-dashboard"; 
    }, 800);
  }

  // --- 2. WAITLIST LOGIC (FORMSPREE INTEGRATION) ---
  async function handleWaitlist(e) {
    e.preventDefault(); // Stop page refresh
    
    const emailInput = document.getElementById('waitlist-email');
    const email = emailInput.value;
    const statusMsg = document.getElementById('waitlist-status');
    const btn = document.querySelector('.gatekeeper-btn.secondary');
    
    // YOUR LIVE ENDPOINT
    const endpoint = "https://formspree.io/f/mbddzwgj";

    if (!email) return;

    // UI Loading State
    btn.innerHTML = "TRANSMITTING...";
    btn.style.opacity = "0.7";
    statusMsg.style.display = "block";
    statusMsg.style.color = "#FFFF00";
    statusMsg.innerText = ">> CONNECTING TO SERVER...";

    try {
      const response = await fetch(endpoint, {
        method: "POST",
        body: JSON.stringify({ email: email, source: "Agitator Index Gatekeeper" }),
        headers: { 
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        }
      });

      if (response.ok) {
        // Success State
        statusMsg.innerText = ">> PRIORITY ACCESS LOGGED. CHECK INBOX.";
        statusMsg.style.color = "#00FF41";
        emailInput.value = "";
        btn.innerHTML = "REQUEST SENT";
        btn.disabled = true;
      } else {
        // Error State
        throw new Error('Submission failed');
      }
    } catch (error) {
      statusMsg.innerText = ">> CONNECTION ERROR. TRY AGAIN.";
      statusMsg.style.color = "#FF3333";
      btn.innerHTML = "RETRY ACCESS";
      btn.style.opacity = "1";
    }
  }
</script>

</body>
</html>
